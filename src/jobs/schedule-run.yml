description: >
  Clone test project and schedule e2e automated run on Testlio platform.

executor: default

parameters:
  dir:
    type: string
    default: "."
    description: |
      Select the path to test project sources. Default is current directory.
  token:
    type: string
    default: "TESTLIO_RUN_API_TOKEN"
    description: |
      Enter the name of the environment variable containing the Testlio Run API token to be used for authentication. Default is "TESTLIO_RUN_API_TOKEN".
  attach-workspace:
    type: boolean
    default: false
    description: |
      Boolean for whether or not to attach to an existing workspace. Default is false.
steps:
  - when:
      condition: << parameters.attach-workspace >>
      steps:
        - attach_workspace:
            at: ./
  - setup:
      token: << parameters.token >>
  - run:
      name: Navigate to the project directory
      environmnent:
        PROJECT_DIR: << parameters.dir >>
      command: "cd ${PROJECT_DIR} || exit"
  - package
  - create-run
